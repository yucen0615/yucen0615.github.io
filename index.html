<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>行事曆</title>
<style>
:root {
    --bg: #ffffff;
    --text: #222222;
    --card: #f4f4f4;
    --accent: #4A90E2;
}
body.dark {
    --bg: #1e1e1e;
    --text: #eaeaea;
    --card: #2a2a2a;
    --accent: #6aa9ff;
}
body {
    font-family: sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
}
.top { display: flex; justify-content: space-between; align-items: center; }
button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: var(--accent);
    color: white;
    font-size: 14px;
    margin-left: 5px;
}
.calendar {
    margin-top: 20px;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
}
.day {
    background: var(--card);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    position: relative;
    color: var(--text);
}
.today { border: 2px solid var(--accent); }
.event-dot { width: 8px; height: 8px; border-radius: 50%; position: absolute; left: 50%; transform: translateX(-50%); }
.exam-dot { background: #e74c3c; bottom: 5px; }
.hw-dot { background: #3498db; bottom: 5px; }
#modal {
    position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center;
}
#modalContent {
    background: var(--card);
    padding: 20px;
    border-radius: 10px;
    width: 300px;
}
textarea, select { font-family: sans-serif; width: 100%; margin-bottom: 10px; padding:6px; border-radius:6px; }
</style>
</head>
<body>

<div class="top">
    <h2 id="monthTitle"></h2>
    <div>
        <button onclick="prevMonth()">上個月</button>
        <button onclick="nextMonth()">下個月</button>
        <button onclick="toggleDark()">深色模式</button>
    </div>
</div>

<div class="calendar" id="calendar"></div>

<div id="modal">
    <div id="modalContent">
        <h3 id="modalDate"></h3>
        <select id="eventType">
            <option value="exam">考試</option>
            <option value="hw">作業</option>
        </select>
        <textarea id="eventInput" rows="4"></textarea>
        <button onclick="saveEvent()">保存</button>
    </div>
</div>

<script>
let current = new Date();
let selectedDate = null;
let events = JSON.parse(localStorage.getItem('events') || '{}');

function renderCalendar(){
    const year = current.getFullYear();
    const month = current.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month+1, 0).getDate();
    document.getElementById('monthTitle').innerText = `${year} 年 ${month+1} 月`;

    const cal = document.getElementById('calendar');
    cal.innerHTML = '';
    for(let i=0;i<firstDay;i++) cal.innerHTML += '<div></div>';
    for(let d=1; d<=lastDate; d++){
        const today = new Date();
        const id = `${year}-${month+1}-${d}`;
        const hasEvent = events[id];
        cal.innerHTML += `<div class="day ${today.toDateString() === new Date(year,month,d).toDateString() ? 'today' : ''}" onclick="openModal('${id}')">
                            ${d}
                            ${hasEvent ? `<div class="event-dot ${hasEvent.type==='exam'?'exam-dot':'hw-dot'}"></div>` : ''}
                         </div>`;
    }
}

function prevMonth(){ current.setMonth(current.getMonth()-1); renderCalendar(); }
function nextMonth(){ current.setMonth(current.getMonth()+1); renderCalendar(); }
function toggleDark(){ document.body.classList.toggle('dark'); }

function openModal(id){
    selectedDate = id;
    document.getElementById('modalDate').innerText = id;
    if(events[id]){
        document.getElementById('eventInput').value = events[id].text;
        document.getElementById('eventType').value = events[id].type;
    } else {
        document.getElementById('eventInput').value = '';
        document.getElementById('eventType').value = 'exam';
    }
    document.getElementById('modal').style.display = 'flex';
}

function saveEvent(){
    const text = document.getElementById('eventInput').value.trim();
    const type = document.getElementById('eventType').value;
    if(text===''){ delete events[selectedDate]; }
    else { events[selectedDate] = { text, type }; }
    localStorage.setItem('events', JSON.stringify(events));
    document.getElementById('modal').style.display = 'none';
    renderCalendar();
    checkReminder();
}

window.onclick = e => { if(e.target===document.getElementById('modal')) document.getElementById('modal').style.display='none'; }

function checkReminder(){
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate()+1);
    const id = `${tomorrow.getFullYear()}-${tomorrow.getMonth()+1}-${tomorrow.getDate()}`;
    if(events[id]) alert(`明天有事件：\n\n${events[id].text}`);
}

renderCalendar();
checkReminder();
</script>

</body>
</html>
